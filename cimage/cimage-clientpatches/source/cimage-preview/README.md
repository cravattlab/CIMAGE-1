`cimage-preview` is a submodule of `cimage-clientpatches` and as such it requires that the former is built and working. This page primarily deals with getting `modify_existing_dta.py` (also known as `add_preview`) up and running.

### Usage

For simple use: `add_preview file1 file2 file3`. Globbing is supported and encouraged: `add_preview ~/mydir/experiments/sample*/*combined*.html`.

Script must be run on `.html` files. Consult help text for additional arguments:

```
add_preview --help
usage: modify-existing-dta.py [-h] [-b] [-d] [-r] [-R] ...

Enhance cimage html output with preview script

positional arguments:
  args

optional arguments:
  -h, --help       show this help message and exit
  -b, --backup     Backup file before adding script
  -q, --quick      Do simple string substitution without parsing html.
  -r, --remove     Removes script from files
  -R, --removeall  Removes ALL scripts from files
```

### Building

This is assuming you already have Python 2.7.7 (or later) installed, as well as pip and virtualenv. First, we setup our virtual environment:

```shell
virtualenv env
source env/bin/activate
pip install -r requirements.txt
deactivate
```

It is important that your virtual environment is called env since the bash script looks for this. If you like to setup your virtual environments in a different fashion then edit the bash file accordingly. Alternatively, you may use the python script directly.

Now, rename `config.sample.py` to `config.py`, and edit its content to reflect the path to the distribution directory generated by building `cimage-clientpatches`. Note that this path should be accessible by a web browser on the network that you're on. Do not make this point to the system path!

To make it easier for users to use the script it is recommended that you make a softlink to `modify_existing_dta.sh`. For example:


```
sudo ln -s ${PWD}/modify_existing_dta.sh /usr/local/bin/add_preview
```
